<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>v1.0.0 - 发布详情</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", sans-serif;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .commit-item {
        transition: all 0.2s ease;
      }
      .commit-item:hover {
        background-color: #f8fafc;
      }
      .tech-badge {
        background: linear-gradient(45deg, #ec4899, #be185d);
      }
      .download-badge {
        background: linear-gradient(45deg, #10b981, #059669);
      }
      pre {
        background: #1e293b;
        color: #e2e8f0;
        border-radius: 8px;
        overflow-x: auto;
      }
      .highlight {
        background-color: #fef3cd;
        padding: 2px 4px;
        border-radius: 3px;
      }
      .copy-button {
        transition: all 0.2s ease;
      }
      .copy-button:hover {
        background-color: #374151;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // 演示数据
      const releaseData = {
        version: "1.0.0",
        createdAt: "2024-07-12T10:30:00.000Z",
        commitHash: "abc1234567890abcdef1234567890abcdef123456",
        privateBranch: "main",
        triggerEvent: "push",
        triggerRepo: "your-org/your-repo",
        triggerBranch: "main",
        triggerCommit: "def4567890123456789012345678901234567890",
        triggerAuthor: "developer",
        commitMessage: "feat: 添加新功能和性能优化",
        changelog: `## 🎉 版本 1.0.0

### 📝 私有仓库最新提交

#### 📋 \`main\` 分支最新提交
  - feat: 添加用户认证功能 (<a href="https://github.com/example/repo/commit/abc123" target="_blank">abc123</a>)
  - fix: 修复数据库连接问题 (<a href="https://github.com/example/repo/commit/def456" target="_blank">def456</a>)
  - docs: 更新 API 文档 (<a href="https://github.com/example/repo/commit/ghi789" target="_blank">ghi789</a>)

#### 📋 \`dev\` 分支最新提交
  - test: 添加单元测试覆盖 (<a href="https://github.com/example/repo/commit/jkl012" target="_blank">jkl012</a>)
  - refactor: 优化代码结构 (<a href="https://github.com/example/repo/commit/mno345" target="_blank">mno345</a>)
`,
        githubBaseUrl: "https://github.com/example/repo",
        repoPath: "example/repo",
        downloadFiles: [
          {
            name: "app-v1.0.0-darwin-x64.7z",
            size: 15728640,
            browser_download_url:
              "https://github.com/aqz236/git-build-test/releases/download/v1.0.0/app-v1.0.0-darwin-x64.7z",
            updated_at: "2024-01-15T10:30:00Z",
          },
          {
            name: "app-v1.0.0-linux-x64.7z",
            size: 14567892,
            browser_download_url:
              "https://github.com/aqz236/git-build-test/releases/download/v1.0.0/app-v1.0.0-linux-x64.7z",
            updated_at: "2024-01-15T10:30:00Z",
          },
          {
            name: "source-code.zip",
            size: 2048576,
            browser_download_url:
              "https://github.com/aqz236/git-build-test/releases/download/v1.0.0/source-code.zip",
            updated_at: "2024-01-15T10:30:00Z",
          },
        ],
      };

      function App() {
        const [activeTab, setActiveTab] = useState("overview");
        const [copied, setCopied] = useState(false);

        const formatDate = (dateString) => {
          const date = new Date(dateString);
          return date.toLocaleString("zh-CN", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
        };

        const copyToClipboard = (text) => {
          navigator.clipboard.writeText(text).then(() => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          });
        };

        const parseChangelog = (changelog) => {
          const sections = {};
          const lines = changelog.split("\n");
          let currentSection = null;
          let currentContent = [];

          lines.forEach((line) => {
            if (line.startsWith("###") || line.startsWith("####")) {
              if (currentSection) {
                sections[currentSection] = currentContent.join("\n");
              }
              currentSection = line
                .replace(/^#+\s*/, "")
                .replace(/📝|📋|🔧|⚠️|📦|🔓/g, "")
                .trim();
              currentContent = [];
            } else if (currentSection) {
              currentContent.push(line);
            }
          });

          if (currentSection) {
            sections[currentSection] = currentContent.join("\n");
          }

          return sections;
        };

        const renderCommitList = (content) => {
          const lines = content.split("\n").filter((line) => line.trim());
          const commits = [];
          let currentBranch = null;

          lines.forEach((line) => {
            if (line.includes("分支最新提交")) {
              currentBranch = line.match(/`([^`]+)`/)?.[1] || "unknown";
            } else if (line.trim().startsWith("- ") && currentBranch) {
              const commitText = line.replace(/^\s*-\s*/, "");
              commits.push({ branch: currentBranch, text: commitText });
            }
          });

          return (
            <div className="space-y-4">
              {Object.entries(
                commits.reduce((acc, commit) => {
                  if (!acc[commit.branch]) acc[commit.branch] = [];
                  acc[commit.branch].push(commit.text);
                  return acc;
                }, {})
              ).map(([branch, commitTexts]) => (
                <div
                  key={branch}
                  className="bg-white rounded-lg p-4 border border-gray-200"
                >
                  <h4 className="font-semibold text-gray-800 mb-3 flex items-center">
                    <i className="fas fa-code-branch mr-2 text-blue-500"></i>
                    {branch} 分支
                  </h4>
                  <div className="space-y-2">
                    {commitTexts.map((commitText, idx) => (
                      <div
                        key={idx}
                        className="commit-item p-2 rounded border-l-4 border-blue-200"
                      >
                        <div dangerouslySetInnerHTML={{ __html: commitText }} />
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          );
        };

        const changelogSections = parseChangelog(releaseData.changelog);

        return (
          <div className="min-h-screen">
            {/* Header */}
            <header className="gradient-bg text-white py-12">
              <div className="container mx-auto px-6">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="flex items-center mb-4">
                      <a
                        href="../"
                        className="text-white hover:text-gray-200 mr-4"
                      >
                        <i className="fas fa-arrow-left text-xl"></i>
                      </a>
                      <h1 className="text-4xl font-bold">
                        版本 {releaseData.version}
                      </h1>
                    </div>
                    <div className="flex flex-wrap gap-4 text-sm opacity-90">
                      <span className="flex items-center">
                        <i className="fas fa-calendar-alt mr-2"></i>
                        {formatDate(releaseData.createdAt)}
                      </span>
                      <span className="flex items-center">
                        <i className="fas fa-code-commit mr-2"></i>
                        <code className="bg-white bg-opacity-20 px-2 py-1 rounded">
                          {releaseData.commitHash.substring(0, 7)}
                        </code>
                      </span>
                      <span className="flex items-center">
                        <i className="fas fa-code-branch mr-2"></i>
                        {releaseData.privateBranch}
                      </span>
                    </div>
                  </div>
                  <div className="hidden md:block">
                    <div className="text-right">
                      <div className="text-2xl mb-2">🎉</div>
                      <div className="text-sm opacity-90">发布成功</div>
                    </div>
                  </div>
                </div>
              </div>
            </header>

            {/* Navigation Tabs */}
            <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
              <div className="container mx-auto px-6">
                <div className="flex space-x-8">
                  {[
                    {
                      id: "overview",
                      label: "概览",
                      icon: "fas fa-chart-line",
                    },
                    {
                      id: "commits",
                      label: "提交记录",
                      icon: "fas fa-code-commit",
                    },
                    { id: "download", label: "下载", icon: "fas fa-download" },
                    { id: "tech", label: "技术栈", icon: "fas fa-cogs" },
                  ].map((tab) => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`py-4 px-2 border-b-2 font-medium text-sm flex items-center transition-colors ${
                        activeTab === tab.id
                          ? "border-blue-500 text-blue-600"
                          : "border-transparent text-gray-500 hover:text-gray-700"
                      }`}
                    >
                      <i className={`${tab.icon} mr-2`}></i>
                      {tab.label}
                    </button>
                  ))}
                </div>
              </div>
            </div>

            {/* Main Content */}
            <main className="container mx-auto px-6 py-8">
              {activeTab === "overview" && (
                <div className="space-y-8">
                  {/* Build Information */}
                  <div className="bg-white rounded-xl shadow-lg p-8 card-hover">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                      <i className="fas fa-info-circle mr-3 text-blue-500"></i>
                      构建信息
                    </h2>
                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-4">
                        <div>
                          <label className="font-medium text-gray-700">
                            发布版本
                          </label>
                          <p className="text-gray-600 mt-1">
                            {releaseData.version}
                          </p>
                        </div>
                        <div>
                          <label className="font-medium text-gray-700">
                            发布时间
                          </label>
                          <p className="text-gray-600 mt-1">
                            {formatDate(releaseData.createdAt)}
                          </p>
                        </div>
                        <div>
                          <label className="font-medium text-gray-700">
                            私有仓库提交
                          </label>
                          <div className="flex items-center mt-1">
                            <code className="bg-gray-100 px-3 py-1 rounded mr-2">
                              {releaseData.commitHash}
                            </code>
                            <button
                              onClick={() =>
                                copyToClipboard(releaseData.commitHash)
                              }
                              className="copy-button p-1 rounded hover:bg-gray-100"
                              title="复制提交哈希"
                            >
                              <i
                                className={`fas ${
                                  copied
                                    ? "fa-check text-green-500"
                                    : "fa-copy text-gray-500"
                                }`}
                              ></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div>
                          <label className="font-medium text-gray-700">
                            触发事件
                          </label>
                          <p className="text-gray-600 mt-1">
                            {releaseData.triggerEvent}
                          </p>
                        </div>
                        <div>
                          <label className="font-medium text-gray-700">
                            触发仓库
                          </label>
                          <p className="text-gray-600 mt-1">
                            {releaseData.triggerRepo}
                          </p>
                        </div>
                        <div>
                          <label className="font-medium text-gray-700">
                            触发分支
                          </label>
                          <p className="text-gray-600 mt-1">
                            {releaseData.triggerBranch}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Commit Message */}
                  <div className="bg-white rounded-xl shadow-lg p-8 card-hover">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                      <i className="fas fa-comment-alt mr-3 text-green-500"></i>
                      提交消息
                    </h2>
                    <div className="bg-gray-50 rounded-lg p-4">
                      <p className="text-gray-700 leading-relaxed">
                        {releaseData.commitMessage}
                      </p>
                    </div>
                  </div>
                </div>
              )}

              {activeTab === "commits" && (
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i className="fas fa-code-commit mr-3 text-purple-500"></i>
                    提交记录
                  </h2>
                  {changelogSections["私有仓库最新提交"] ? (
                    renderCommitList(changelogSections["私有仓库最新提交"])
                  ) : (
                    <p className="text-gray-500">暂无提交记录</p>
                  )}
                </div>
              )}

              {activeTab === "download" && (
                <div className="space-y-8">
                  {/* Download Files */}
                  <div className="bg-white rounded-xl shadow-lg p-8 card-hover">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                      <i className="fas fa-download mr-3 text-green-500"></i>
                      构建产物下载
                    </h2>

                    {/* Download Files List */}
                    {releaseData.downloadFiles &&
                    releaseData.downloadFiles.length > 0 ? (
                      <div className="grid gap-4 mb-8">
                        {releaseData.downloadFiles.map((file, index) => {
                          const isPlatformFile =
                            file.name.includes("darwin") ||
                            file.name.includes("linux");
                          const platform = file.name.includes("darwin")
                            ? "macOS"
                            : file.name.includes("linux")
                            ? "Linux"
                            : "Other";
                          const platformIcon = file.name.includes("darwin")
                            ? "fab fa-apple"
                            : file.name.includes("linux")
                            ? "fab fa-linux"
                            : "fas fa-file";

                          return (
                            <div
                              key={index}
                              className="bg-gray-50 rounded-lg p-6 border border-gray-200 hover:border-green-300 transition-colors"
                            >
                              <div className="flex items-center justify-between">
                                <div className="flex items-center flex-1">
                                  <div className="mr-4">
                                    <i
                                      className={`${platformIcon} text-2xl ${
                                        file.name.includes("darwin")
                                          ? "text-gray-600"
                                          : file.name.includes("linux")
                                          ? "text-blue-600"
                                          : "text-gray-500"
                                      }`}
                                    ></i>
                                  </div>
                                  <div className="flex-1">
                                    <h3 className="font-semibold text-gray-800 mb-1">
                                      {file.name}
                                    </h3>
                                    <div className="flex items-center space-x-4 text-sm text-gray-600">
                                      {isPlatformFile && (
                                        <span className="flex items-center">
                                          <i className="fas fa-desktop mr-1"></i>
                                          {platform}
                                        </span>
                                      )}
                                      <span className="flex items-center">
                                        <i className="fas fa-file-archive mr-1"></i>
                                        {(file.size / 1024 / 1024).toFixed(1)}{" "}
                                        MB
                                      </span>
                                      <span className="flex items-center">
                                        <i className="fas fa-clock mr-1"></i>
                                        {new Date(
                                          file.updated_at
                                        ).toLocaleDateString("zh-CN")}
                                      </span>
                                    </div>
                                  </div>
                                </div>
                                <a
                                  href={file.browser_download_url}
                                  download
                                  className="download-badge text-white px-6 py-3 rounded-lg hover:shadow-lg transition-all flex items-center font-medium"
                                >
                                  <i className="fas fa-download mr-2"></i>
                                  下载
                                </a>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    ) : (
                      <div className="text-center py-12 text-gray-500">
                        <i className="fas fa-inbox text-4xl mb-4"></i>
                        <p>暂无可下载的构建产物</p>
                      </div>
                    )}

                    {/* Download Instructions */}
                    <div className="border-t border-gray-200 pt-8">
                      <h3 className="text-xl font-bold text-gray-800 mb-6">
                        使用说明
                      </h3>

                      <div className="grid md:grid-cols-2 gap-8">
                        {/* macOS */}
                        <div className="bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-6">
                          <h4 className="font-bold text-lg mb-4 flex items-center">
                            <i className="fab fa-apple mr-2 text-gray-600"></i>
                            macOS
                          </h4>
                          <div className="space-y-3 text-sm">
                            <p>
                              1. 下载{" "}
                              <code className="bg-white px-2 py-1 rounded">
                                app-*-darwin-x64.7z
                              </code>
                            </p>
                            <p>2. 解压后添加执行权限:</p>
                            <pre className="p-3 text-xs">
                              <code>
                                chmod +x app-*-darwin-x64 && ./app-*-darwin-x64
                              </code>
                            </pre>
                            <p className="text-amber-600">
                              <i className="fas fa-exclamation-triangle mr-1"></i>
                              如遇安全提示，请在系统偏好设置中允许运行
                            </p>
                          </div>
                        </div>

                        {/* Linux */}
                        <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-6">
                          <h4 className="font-bold text-lg mb-4 flex items-center">
                            <i className="fab fa-linux mr-2 text-blue-600"></i>
                            Linux
                          </h4>
                          <div className="space-y-3 text-sm">
                            <p>
                              1. 下载{" "}
                              <code className="bg-white px-2 py-1 rounded">
                                app-*-linux-x64.7z
                              </code>
                            </p>
                            <p>2. 解压后添加执行权限:</p>
                            <pre className="p-3 text-xs">
                              <code>
                                chmod +x app-*-linux-x64 && ./app-*-linux-x64
                              </code>
                            </pre>
                          </div>
                        </div>
                      </div>

                      {/* Security Note */}
                      <div className="mt-8 bg-amber-50 border border-amber-200 rounded-lg p-6">
                        <h4 className="font-bold text-amber-800 mb-3 flex items-center">
                          <i className="fas fa-shield-alt mr-2"></i>
                          安全说明
                        </h4>
                        <div className="text-amber-700 space-y-2 text-sm">
                          <p>• 所有构建产物都经过密码加密的 7z 压缩包保护</p>
                          <p>• 解压密码请联系管理员获取</p>
                          <p>• 请确保从官方渠道下载，避免安全风险</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {activeTab === "tech" && (
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i className="fas fa-cogs mr-3 text-purple-500"></i>
                    技术栈
                  </h2>
                  <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    {[
                      {
                        name: "Bun",
                        icon: "fas fa-bolt",
                        color: "bg-yellow-500",
                      },
                      {
                        name: "ElysiaJS",
                        icon: "fas fa-server",
                        color: "bg-blue-500",
                      },
                      {
                        name: "Drizzle ORM",
                        icon: "fas fa-database",
                        color: "bg-green-500",
                      },
                      {
                        name: "PostgreSQL",
                        icon: "fas fa-elephant",
                        color: "bg-blue-600",
                      },
                      {
                        name: "DDD + CQRS",
                        icon: "fas fa-sitemap",
                        color: "bg-purple-500",
                      },
                      {
                        name: "GitHub Actions",
                        icon: "fab fa-github",
                        color: "bg-gray-800",
                      },
                    ].map((tech, index) => (
                      <div
                        key={index}
                        className="text-center p-4 rounded-lg border border-gray-200 card-hover"
                      >
                        <div
                          className={`w-12 h-12 ${tech.color} rounded-full flex items-center justify-center mx-auto mb-3`}
                        >
                          <i className={`${tech.icon} text-white text-xl`}></i>
                        </div>
                        <h3 className="font-semibold text-gray-800">
                          {tech.name}
                        </h3>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </main>
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
